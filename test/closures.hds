import libc as c;

def main(): Void {
    val capture = b"capture";
    val print_str = |str: *Byte|: *Byte {
        c.puts(capture);
        c.puts(b"printing string");
        c.puts(str);
        return b"result";
    };

    val result = print_both_and_return_second[Bool, *Byte, *Byte](true, b"hello", |b| {
        c.puts(capture);
        c.puts(b"printing boolean");
        if b {
            c.puts(b"true");
        } else {
            c.puts(b"false");
        }
    }, print_str);

    c.puts(b"closure application returned value");
    c.puts(result);
}

extern def f(): Void = f;

def print_both_and_return_second[T1, T2, T2R](first: T1, second: T2, print_first: (T1) -> Void, print_second: (T2) -> T2R): T2R {
    print_first(first);
    return print_second(second);
}
